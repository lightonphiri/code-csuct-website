<HTML>
<HEAD>
<TITLE>/home/phiri/Dropbox/Projects/work/2016/csc1011h/Moss/tutorial3/raw/Mamali,_Fhulufhelo(mmlfhu003)/</TITLE>
</HEAD>
<BODY BGCOLOR=white>
<HR>
/home/phiri/Dropbox/Projects/work/2016/csc1011h/Moss/tutorial3/raw/Velaphi,_Siphetho(vlpsip001)/<p><PRE>
&gt;&gt;&gt;&gt; file: Sale_tabel.py
import sqlite3

conn=sqlite3.connect("Sale.db")
c=conn.cursor()

def table():
    c.execute("CREATE TABLE IF NOT EXISTS sale(Stock code INT,Quantity INT,Time TXT,Date TXT)")
    conn.commit()
    c.close()
table()    &gt;&gt;&gt;&gt; file: Stock_table.py
import sqlite3

db = sqlite3.connect('Stock_table.db')
db.execute('create table Stock(Stock Code integer,Item Name text,Discription text,Cost Price real,Sales Price real,Quantity Stock integer)')
db.execute('insert into Stock values (?,?,?,?,?,?)',(1,'Banana','Each',5,3,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(2,'Apple','Each',4,2.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(3,'Guava','Each',2,1.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(4,'Peach','Each',3,2,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(5,'Mango','Each',9,11,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(6,'Pear','Each',4,2.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(7,'Orange','Each',2,1.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(8,'Cherry','Each',2,1.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(9,'Rasberry','Each',2,1.50,20))
db.execute('insert into Stock values (?,?,?,?,?,?)',(10,'Ovacado','Each',5,3,20))
db.commit()

&gt;&gt;&gt;&gt; file: Tuck_shop.py
<A NAME="1"></A><FONT color = #00FF00><A HREF="match13-0.html#1" TARGET="0"><IMG SRC="../../bitmaps/tm_1_3.gif" ALT="other" BORDER="0" ALIGN=left></A>

import sys
from PyQt4 import QtGui
import sqlite3
#import Stock_table
conn=sqlite3.connect("Stock_table.db")
p=conn.cursor()
conn2=sqlite3.connect("Sale.db")
t=conn2.cursor()
</FONT>
<A NAME="2"></A><FONT color = #0000FF><A HREF="match13-0.html#2" TARGET="0"><IMG SRC="../../bitmaps/tm_2_2.gif" ALT="other" BORDER="0" ALIGN=left></A>

from datetime import datetime
class MyWidget(QtGui.QWidget):	# MyWidget inherits from QWidget
    def __init__(self, parent=None):  	# parent defines parent widget
        QtGui.QWidget.__init__(self, parent)	# super class constructor
        self.setGeometry(250, 250, 400, 300)       	# x,y,width,height
</FONT>        self.setWindowTitle('Widget Window')  #set window tit
        
        self.box=QtGui.QComboBox()
        self.box.addItem('Banana')
        self.box.addItem('Apple')
        self.box.addItem('Guava')
        self.box.addItem('Peach')
        self.box.addItem('Mango')
        self.box.addItem('Pear')
        self.box.addItem('Orange')
        self.box.addItem('Chery')
        self.box.addItem('Rusrberry')
        self.box.addItem('Ovacado')
        self.edit=QtGui.QLineEdit()
        self.fruit_label=QtGui.QLabel("Choose fruit:")
        self.edit_label= QtGui.QLabel("How many:")
        self.ok_button= QtGui.QPushButton("OK")
        self.ok_button.clicked.connect(self.ok)
        self.report_button=QtGui.QPushButton('Sales report')
        self.report_button.clicked.connect(self.report)
        self.close_button=QtGui.QPushButton("Close")
        self.close_button.clicked.connect(self.buttonClicked)
        self.grid=QtGui.QGridLayout()
        self.grid.addWidget(self.fruit_label,0,0)
        self.grid.addWidget(self.box,0,1)
        self.grid.addWidget(self.edit_label,1,0)
        self.grid.addWidget(self.edit,1,1)
        self.grid.addWidget(self.ok_button,2,0)
        self.grid.addWidget(self.report_button,2,1)
        self.grid.addWidget(self.close_button,2,2)
<A NAME="0"></A><FONT color = #FF0000><A HREF="match13-0.html#0" TARGET="0"><IMG SRC="../../bitmaps/tm_0_3.gif" ALT="other" BORDER="0" ALIGN=left></A>

        self.setLayout(self.grid)
        self.error=QtGui.QLabel("",self)
        self.error.setGeometry(20,150,200,50)
        self.Vbox=QtGui.QVBoxLayout()
        self.sold_label= QtGui.QLabel("")
</FONT>        self.cost_label=QtGui.QLabel("")
        self.sale_label=QtGui.QLabel("")
        self.profit_label=QtGui.QLabel("")
        self.Vbox.addWidget(self.sold_label)
        self.Vbox.addWidget(self.cost_label)
        self.Vbox.addWidget(self.sale_label)
        self.Vbox.addWidget(self.profit_label)
        self.widget=QtGui.QWidget()
        
        self.widget.setLayout(self.Vbox)
        
    def buttonClicked(self):		# buttonClicked slot event handler
        self.close()
    def ok(self):
        quantity= self.edit.displayText()
        item= self.box.currentText()
        p.execute("SELECT *FROM Stock WHERE Item=?",(item,))
        items=p.fetchone()
        date=str(datetime.now())[0:11]
        time=str(datetime.now())[11:19]
       
        if int(items[-1])&gt;=int(quantity):
            self.error.clear()
            
            t.execute("INSERT INTO sale(stock,Quantity,Time,Date) values(?,?,?,?)",(items[0],items[-1],time,date)) 
            conn2.commit()
            left_stock=int(items[-1])-int(quantity)
            p.execute("UPDATE Stock SET Quantity=(?) WHERE Item=(?)",(left_stock,item,))
            conn.commit()
            self.edit.clear()
        else:
            self.error.setText("Item is out of Stock")
            self.edit.clear()
            
    def report(self):
        self.widget.setGeometry(20,20,300,300)
        t.execute("SELECT *FROM sale")
        items=t.fetchall() 
        total_number_of_items=0
        stockcode=[]
        for i in items:
            total_number_of_items+=int(i[1])
            stockcode.append(str(i[0]))
        total_number_of_items=str(total_number_of_items)
        p.execute("SELECT *FROM Stock")
        item=p.fetchall() 
        saleprice=0
        costprice=0
        print(item)
        for i in item:
            costprice+=i[3]
            saleprice+=i[4]
        profit=str(costprice-saleprice)
        costprice=str(costprice)
        saleprice=str(saleprice)        
        print(profit)
        self.profit_label.setText("The total profit:   R"+profit)
        self.cost_label.setText("The cost price:   R"+costprice)
        self.sale_label.setText("The sales price:   R"+saleprice)
        self.sold_label.setText("Total items sold  "+total_number_of_items)
        self.widget.show()        
        
def main():
    app = QtGui.QApplication(sys.argv)
    my_widget = MyWidget()		# create MyWidget object
    my_widget.show()
    sys.exit(app.exec_())
main()</PRE>
</PRE>
</BODY>
</HTML>
