<HTML>
<HEAD>
<TITLE>/home/phiri/Dropbox/Projects/work/2016/csc1011h/Moss/tutorial3/raw/Dikgang,_Taeo(dkgtha005)/</TITLE>
</HEAD>
<BODY BGCOLOR=white>
<HR>
/home/phiri/Dropbox/Projects/work/2016/csc1011h/Moss/tutorial3/raw/Makanatleng,_Phashe(mknpha002)/<p><PRE>
&gt;&gt;&gt;&gt; file: Main.py
from PyQt4 import QtGui, QtCore
import sys,sqlite3, time, os

class MainWidget(QtGui.QWidget):
    def __init__(self,parent= None):
        QtGui.QWidget.__init__(self,parent)
        
        self.setGeometry(300,300,600,300)
        
        self.setWindowTitle("Tuckshop Point of Sale")
        
        self.setWindowIcon(QtGui.QIcon("shop.png"))
        
        self.btnClose = QtGui.QPushButton("Close",self)
        
        self.Database = ''
        self.TableName1 = ''
        self.TableName2 = ''
        
        self.btnOk = QtGui.QPushButton("Ok",self)
        
        self.edit = QtGui.QLineEdit(self)
        
        self.cmbChoose = QtGui.QComboBox()
        
        self.btnReport = QtGui.QPushButton("Sales Report",self)
        
        self.lblHead = QtGui.QLabel("--------Tuck Shop (POS)--------",self)
        self.lblHead.setFont(QtGui.QFont("Courier",18,QtGui.QFont.Bold,False))
        
        self.lblChoose = QtGui.QLabel("Choose Item",self)
        self.lblChoose.setFont(QtGui.QFont("Courier",14))
        
        
        self.lblQuantity = QtGui.QLabel("Enter the Quantity",self)
        self.lblQuantity.setFont(QtGui.QFont("Courier",14))
        
        self.theGrid = QtGui.QGridLayout()

        self.theGrid.setRowMinimumHeight(0,30)
        self.theGrid.setRowMinimumHeight(1,15)
        self.theGrid.setRowMinimumHeight(2,15)
        self.theGrid.setRowMinimumHeight(3,15)
        self.theGrid.setRowMinimumHeight(4,15)
     
        self.theGrid.setColumnMinimumWidth(0,20)
        self.theGrid.setColumnMinimumWidth(1,100)
        
        self.theGrid.addWidget(self.btnClose,4,0)
        
        self.theGrid.addWidget(self.btnOk,3,1)
        
        self.theGrid.addWidget(self.edit,2,1)
        
        self.theGrid.addWidget(self.cmbChoose,1,1)
        
        self.theGrid.addWidget(self.btnReport,4,1)
        
        self.theGrid.addWidget(self.lblHead,0,0,1,2)
        
        self.theGrid.addWidget(self.lblQuantity,2,0)
        
        self.theGrid.addWidget(self.lblChoose,1,0)
        self.theGrid.setColumnStretch(0,100)
        self.theGrid.setColumnStretch(1,150)

        self.setLayout(self.theGrid)
        
        self.show()
        
        QtGui.QMessageBox.information(self,"Instructions","Choose the product you want in the drop down list and enter a quantity in the edit box")
        
        self.btnClose.clicked.connect(self.close_)
        self.btnOk.clicked.connect(self.RecordTransaction)
        self.btnReport.clicked.connect(self.runReport)
        
    def runReport(self):
        os.system('report.py')
    def DatabaseInfo(self,Database,TableName1,TableName2):
        self.Database = Database
        self.TableName1 = TableName1
        self.TableName2 = TableName2

    def PopulateList(self):
        
        db = sqlite3.connect(self.Database)
        cursor = db.execute("Select * from "+self.TableName1)
        tuple_ = []
        
        string = ""
        for row in cursor:
            #Stock Code,Name of Item,Item Description,Cost Price,Sales Price, Quantity in Stock
            tuple_ = row
            
            string = tuple_[1]+"_"+tuple_[2] #Adds Item Name and Description together
            
            self.cmbChoose.addItem(string) #adds items and description to combobox
            
    def RecordTransaction(self):
        
        choice = self.cmbChoose.currentText()
        choice = choice[0:choice.index("_")] #separating name from description
        QuantitySold = int(self.edit.displayText())
        db = sqlite3.connect(self.Database) # database we are reading from
        
        cursor = db.execute("Select * from "+self.TableName1)
        
        stockcode = ''
        salesprice = 0.00
        QuantityInStock = 0
        for row in cursor:
            if choice in row:
                stockcode = row[0]
                QuantityInStock = row[5]
                break #stop loop if item is found
            else:
                continue
            
        date_string = time.strftime("%Y/%m/%d")
        
        time_string = time.strftime("%H:%M:%S")
        
        QtGui.QMessageBox.information(self,"Information",stockcode+'_'+str(QuantitySold)+'_'+date_string+'_'+time_string+"---------"+str(QuantityInStock))
        
        if QuantitySold&lt;QuantityInStock:
            db.execute("Insert into "+self.TableName2+" values (?,?,?,?)",(stockcode,QuantitySold,date_string,time_string))
            QuantityInStock = QuantityInStock-1
            aString = "Update "+self.TableName1+" set QuantityInStock = "+str(QuantityInStock)+" where StockCode = \""+stockcode+"\""
            
            db.execute("Update "+self.TableName1+" set QuantityInStock = "+str(QuantityInStock)+" where StockCode = \""+stockcode+"\"")
            
            QtGui.QMessageBox.information(self,"Information","Executed1")
            db.commit()
            QtGui.QMessageBox.information(self,"Information","Executed")
        else:
            if QuantityInStock==0:
                QtGui.QMessageBox.warning(self,"Information","Item "+choice+" out of Stock")
            else:
                QtGui.QMessageBox.warning(self,"Information","Quantity of Item in Stock : "+ QuantityInStock)
                
    def close_(self):
        self.close()
    
          
def main():
    app = QtGui.QApplication(sys.argv)
    
    widget = MainWidget()
    widget.DatabaseInfo("Tuckshop.db","Stock","SalesRecords")
    widget.PopulateList()
    sys.exit(app.exec_())
    
    
main()&gt;&gt;&gt;&gt; file: __init__.py
&gt;&gt;&gt;&gt; file: report.py
import os
from PyQt4 import QtGui, QtCore
import sys,sqlite3, time

class ReportWidget(QtGui.QWidget):
    def __init__(self,parent= None):
        
        QtGui.QWidget.__init__(self,parent)
        
        self.setGeometry(300,300,400,300)
        
        self.setWindowTitle("Sales Report")
        
        self.setWindowIcon(QtGui.QIcon("shop.png"))
        
        self.totalNumberSold = 0
        
        self.totalCostPrice = 0
        
        self.totalSalesPrice = 0
        
        self.totalProfit = 0
        
        self.Database = ''
        self.TableName1 = ''
        self.TableName2 = ''
        
        self.lblTotalNumberOfItemsSold = QtGui.QLabel("Total Number of Items Sold :",self)
        self.lblTotalNumberOfItemsSold.setFont(QtGui.QFont("Courier", 14))
        self.lblOutput1 = QtGui.QLabel("",self)
        
        self.lblTotalCostPrice = QtGui.QLabel("Total Cost Price :",self)
        self.lblTotalCostPrice.setFont(QtGui.QFont("Courier", 14))
        self.lblOutput2 = QtGui.QLabel("",self)
        
        self.lblTotalSalesPrice = QtGui.QLabel("Total Sales Price:",self)
        self.lblTotalSalesPrice.setFont(QtGui.QFont("Courier", 14))
        self.lblOutput3 = QtGui.QLabel("",self)
        
        self.lblTotalProfit = QtGui.QLabel("Total Profit :")
        self.lblTotalProfit.setFont(QtGui.QFont("Courier", 14))
        self.lblOutput4 = QtGui.QLabel("",self)
        
        self.btnClose = QtGui.QPushButton("Close",self)        
        
<A NAME="0"></A><FONT color = #FF0000><A HREF="match42-0.html#0" TARGET="0"><IMG SRC="../../bitmaps/tm_0_2.gif" ALT="other" BORDER="0" ALIGN=left></A>

        self.theGrid_ = QtGui.QGridLayout()
        
        self.theGrid_.addWidget(self.lblTotalNumberOfItemsSold,0,0)
        self.theGrid_.addWidget(self.lblOutput1,0,1)
        self.theGrid_.addWidget(self.lblTotalCostPrice,1,0)
</FONT>        self.theGrid_.addWidget(self.lblOutput2,1,1)
        self.theGrid_.addWidget(self.lblTotalSalesPrice,2,0)
        self.theGrid_.addWidget(self.lblOutput3,2,1)
<A NAME="1"></A><FONT color = #00FF00><A HREF="match42-0.html#1" TARGET="0"><IMG SRC="../../bitmaps/tm_1_1.gif" ALT="other" BORDER="0" ALIGN=left></A>

        self.theGrid_.addWidget(self.lblTotalProfit,3,0)
        self.theGrid_.addWidget(self.lblOutput4,3,1)
        self.theGrid_.addWidget(self.btnClose,4,0)
        
        self.setLayout(self.theGrid_)
</FONT>        self.btnClose.clicked.connect(self.close_)

    def DatabaseInfo(self,Database,TableName1,TableName2):
        self.Database = Database
        self.TableName1 = TableName1
        self.TableName2 = TableName2        
        
        
    def close_(self):
        self.close()
        
        
    def CalculateOutput(self):
        db = sqlite3.connect(self.Database)

        stockcode = ''
        price = 0.00
   
        totalNrOfItemsSold = 0
        totalSalesPrice = 0.00
        totalProfit = 0.00
        
        #Calculate Total number of Items Sold
        cursor = db.execute("Select SalesRecords.QuantitySold FROM "+self.TableName2)
        for row in cursor:
            totalNrOfItemsSold = totalNrOfItemsSold + row[0]

        #Calculate Total Cost Price, Total Sales Price:
        
        cursor = db.execute("Select Stock.StockCode,Stock.CostPrice,Stock.SalesPrice,SalesRecords.QuantitySold FROM Stock INNER JOIN SalesRecords ON Stock.StockCode=SalesRecords.StockCode")
        
        totalCostPrice = 0.00    
        totalSalesPrice = 0.00
        for row in cursor:
            totalCostPrice = totalCostPrice + row[1]
            totalSalesPrice = totalSalesPrice + row[2]
    
        #Calculate Total Profit:
        totalProfit = totalSalesPrice - totalCostPrice
        
        self.lblOutput1.setText(str(totalNrOfItemsSold))
        self.lblOutput2.setText(str(totalCostPrice))
        self.lblOutput3.setText(str(totalSalesPrice))
        self.lblOutput4.setText(str(totalProfit))
        
def SalesReport():
    app_ = QtGui.QApplication(sys.argv)
    Widget_ = ReportWidget()
    Widget_.DatabaseInfo("Tuckshop.db","Stock","SalesRecords")
    Widget_.CalculateOutput()
    Widget_.show()
    sys.exit(app_.exec_())
    
SalesReport()
</PRE>
</PRE>
</BODY>
</HTML>
